<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Virtual Voyage To Gaza</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    html, body { margin: 0; height: 100%; width: 100%; background: black; color: white; font-family: Arial, sans-serif; overflow: hidden; }
    #map { height: calc(100% - 100px); width: calc(100% - 300px); float: right; transition: all 0.3s; }
    #sidebar { width: 300px; background: #111; height: 100%; float: left; padding: 15px; box-sizing: border-box; overflow-y: auto; transition: transform 0.3s; }
    h1 { font-size: 18px; margin: 5px 0 5px; text-align: center; }
    h2 { font-size: 14px; margin: 0 0 10px; text-align: center; color: #ff8080; }
    .ticker-container { overflow: hidden; white-space: nowrap; border-top: 1px solid #333; border-bottom: 1px solid #333; margin-bottom: 10px; }
    .ticker-text { display: inline-block; padding-left: 100%; animation: ticker 25s linear infinite; }
    @keyframes ticker { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
    .flashing-dot { display: inline-block; width: 10px; height: 10px; background: limegreen; border-radius: 50%; animation: flash 1s infinite; vertical-align: middle; }
    @keyframes flash { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
    .section { margin-top: 15px; background: #222; border-radius: 6px; overflow: hidden; }
    .section summary { padding: 8px 10px; cursor: pointer; background: #333; }
    .section p { padding: 5px 10px; margin: 0; }
    label { display: block; margin-top: 15px; text-align: center; font-size: 14px; }
    #boat-list { margin-top: 15px; }
    .boat-item { padding: 5px 8px; background: #222; margin-bottom: 5px; border-radius: 5px; cursor: pointer; }
    .boat-item:hover { background: #333; }
    .boat-item.active { background: #444; border-left: 4px solid #ff8080; }
    #slider-container { width: calc(100% - 300px); height: 80px; background: #111; position: absolute; bottom: 0; right: 0; padding: 10px; box-sizing: border-box; text-align: center; transition: all 0.3s; }
    input[type="range"] { width: 90%; }
    #time-label { display: block; font-size: 14px; margin-top: 5px; }
    #hamburger { display: none; position: absolute; top: 10px; left: 10px; background: #222; color: white; border: none; font-size: 22px; padding: 8px 12px; cursor: pointer; z-index: 1000; border-radius: 5px; }

    /* Arrow styling */
    .ship-arrow {
      width: 0;
      height: 0;
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-bottom: 16px solid;
      border-radius: 2px;
      filter: drop-shadow(0 0 2px white);
      transition: transform 0.5s linear; /* smooth rotation */
    }

    @media screen and (max-width: 1024px) {
      #map { width: 100%; height: calc(100% - 150px); }
      #slider-container { width: 100%; position: relative; bottom: 0; padding: 5px; }
    }
    @media screen and (max-width: 768px) {
      body { overflow: auto; }
      #sidebar { position: absolute; left: 0; top: 0; bottom: 0; transform: translateX(-100%); z-index: 999; width: 250px; }
      #sidebar.open { transform: translateX(0); }
      #map { width: 100%; height: 400px; float: none; }
      #slider-container { width: 100%; position: relative; bottom: 0; padding: 5px; }
      #hamburger { display: block; }
    }
    @media screen and (max-height: 500px) {
      #map { height: 300px; }
      #slider-container { height: 60px; }
    }
  </style>
</head>
<body>
  <button id="hamburger">☰</button>
  <div id="sidebar">
    <h1>Virtual Voyage To Gaza <span class="flashing-dot"></span></h1>
    <h2>In Memory Of</h2>
    <div class="ticker-container">
      <div class="ticker-text">
        Shireen Abu Akleh Hind Rajab Refaat Alareer Razan Al-Najjar Mohammed Al-Durra Ahmad Abu Hussein Wael Dahdouh's Family Iman Hejjo Layan Hamadeh Thousands of Martyrs of Palestine
      </div>
    </div>

    <details class="section">
      <summary>Martyr Poems & Quotes</summary>
      <p><b>Refaat Alareer:</b> "If I must die, let it bring hope."</p>
      <p><b>Shireen Abu Akleh:</b> "I chose journalism so I could be close to the people. It might not be easy to change the reality, but at least I could bring their voices to the world."</p>
      <p><b>Razan Al-Najjar:</b> "I am not afraid to be seen. I want the world to know we care for the wounded and that we will never stop caring."</p>
      <p><b>Hind Rajab:</b> "Tell them... I just want to live."</p>
      <p><b>Ghada Al-Najjar:</b> "Our roots are deep in this land. Even if they burn our olive trees, we will replant them with our blood."</p>
      <p><b>Mohammed Al-Durra:</b> "I am only a child, but I carry the dreams of my people on my shoulders."</p>
    </details>

    <details class="section">
      <summary>What is the Virtual Voyage To Gaza?</summary>
      <p>The <b>Virtual Voyage To Gaza</b> turns gaming into action. When real-world flotillas are blocked, we sail digitally to raise awareness and challenge complicity.</p>
      <p>Players around the world join this mission to show solidarity, keep the struggle visible, and amplify the voices of Gaza. Every click, every virtual sail counts.</p>
      <p>Learn about the real missions here: 
        <a href="https://freedomflotilla.org" target="_blank" style="color: #ff8080; text-decoration: underline;">Freedom Flotilla Coalition</a> and 
        <a href="https://globalsumudflotilla.org" target="_blank" style="color: #ff8080; text-decoration: underline;">Global Sumud Flotilla</a>.
      </p>
      <p><b>Sail, speak out, and make a stand for Gaza! Even the digital world hasn’t forgotten and will not forgive Crimes against Humanity.</b></p>
    </details>

    <label><input type="checkbox" id="breadcrumbsToggle"> Show Breadcrumbs</label>
    <div id="boat-list"></div>
  </div>

  <div id="map"></div>
  <div id="slider-container">
    <input type="range" id="timeSlider" min="0" max="0" value="0" step="1">
    <span id="time-label"></span>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([32.6, 28.9], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '&copy; OpenStreetMap contributors' }).addTo(map);

    const markersLayer = L.layerGroup().addTo(map);
    const breadcrumbsLayer = L.layerGroup().addTo(map);
    let positions = {};
    let userMovedMap = false;
    const boatDivs = {};
    const boatMarkers = {};
    const boatHeading = {};

    map.on('movestart', () => { userMovedMap = true; });

    async function loadPositions(autoUpdate = false) {
      const res = await fetch('fleet_positions.json?t=' + Date.now());
      const newPositions = await res.json();
      if (!newPositions) return;
      positions = Array.isArray(newPositions) ? { fleet: newPositions } : newPositions;

      const slider = document.getElementById('timeSlider');
      let maxLength = 0;
      for (const shipId in positions) maxLength = Math.max(maxLength, positions[shipId].length);
      slider.max = maxLength > 0 ? maxLength - 1 : 0;
      if (!autoUpdate) slider.value = slider.max;

      updateMap(parseInt(slider.value));
      updateSidebar();
    }

    function createArrowHTML(color, heading) {
      return `<div class="ship-arrow" style="
        border-bottom-color:${color};
        transform: rotate(${heading}deg);
        transform-origin: 8px 16px;
      "></div>`;
    }

    function updateMap(index) {
      breadcrumbsLayer.clearLayers();
      const showBreadcrumbs = document.getElementById('breadcrumbsToggle').checked;
      let latSum = 0, lonSum = 0, count = 0;

      for (const shipId in positions) {
        const shipData = positions[shipId];
        if (!shipData.length) continue;
        const pos = shipData[Math.min(index, shipData.length - 1)];

        const color = pos.ghost ? '#475DD1' : '#00008b';
        const newHeading = pos.heading || 0;

        // Smooth heading interpolation
        let oldHeading = boatHeading[shipId] ?? newHeading;
        let delta = ((newHeading - oldHeading + 540) % 360) - 180; // shortest rotation
        let smoothHeading = oldHeading + delta;

        const arrowHtml = createArrowHTML(color, smoothHeading);

        if (boatMarkers[shipId]) {
          boatMarkers[shipId].setLatLng([pos.lat,pos.lon]);
          boatMarkers[shipId].setIcon(L.divIcon({ className:'', html: arrowHtml, iconAnchor:[8,16] }));
        } else {
          boatMarkers[shipId] = L.marker([pos.lat,pos.lon], {
            icon: L.divIcon({ className:'', html: arrowHtml, iconAnchor:[8,16] }),
            color
          }).addTo(markersLayer).on('click', () => highlightBoat(shipId));
        }
        boatHeading[shipId] = smoothHeading;

        if (showBreadcrumbs && shipData.length > 1) {
          const trail = shipData.slice(0, Math.min(index+1, shipData.length)).map(p => [p.lat,p.lon]);
          L.polyline(trail, { color, weight:2 }).addTo(breadcrumbsLayer);
        }

        latSum += pos.lat; lonSum += pos.lon; count++;
      }

      if (!userMovedMap && count>0) map.setView([latSum/count, lonSum/count], map.getZoom());

      let ts = new Date();
      for (const shipId in positions) {
        if (positions[shipId].length > index) { ts = new Date(positions[shipId][index].timestamp); break; }
      }
      document.getElementById('time-label').textContent =
        `${(ts.getMonth()+1).toString().padStart(2,'0')}/${ts.getDate().toString().padStart(2,'0')} ${ts.getHours().toString().padStart(2,'0')}:${ts.getMinutes().toString().padStart(2,'0')}`;
    }

    function highlightBoat(shipId) {
      for (const id in boatDivs) {
        boatDivs[id].classList.toggle('active', id === shipId);
      }
    }

    function updateSidebar() {
      const boatList = document.getElementById('boat-list');
      boatList.innerHTML = '';
      for (const shipId in positions) {
        const shipData = positions[shipId];
        if (!shipData.length) continue;
        const pos = shipData[shipData.length-1];

        const div = document.createElement('div');
        div.className='boat-item';
        div.innerHTML=`${pos.name || shipId}<br>Speed: ${pos.speed || 'N/A'} kn, Heading: ${pos.heading || 'N/A'}°`;

        boatDivs[shipId] = div;
        div.addEventListener('click',()=>{ map.setView([pos.lat,pos.lon],10); highlightBoat(shipId); });

        boatList.appendChild(div);
      }
    }

    document.getElementById('timeSlider').addEventListener('input', e => updateMap(parseInt(e.target.value)));
    document.getElementById('breadcrumbsToggle').addEventListener('change', () => updateMap(parseInt(document.getElementById('timeSlider').value)));
    document.getElementById('hamburger').addEventListener('click', () => document.getElementById('sidebar').classList.toggle('open'));

    loadPositions();
    setInterval(()=>loadPositions(true),60000);
  
// Static list of past flotillas that got close
const pastFlotillas = [
  {
    name: "Madleen",
    year: 2025,
    lat: 31.95236,
    lon: 32.38880,
    status: "Intercepted in international waters, towed to Ashdod",
    confidence: "Medium-High",
    source: "News / maritime reports"
  },
  {
    name: "Handala",
    year: 2025,
    lat: 31.990316,
    lon: 32.802406,
    status: "Organisers’ tracker; intercepted ~64 km from Gaza, diverted to Ashdod",
    confidence: "Medium",
    source: "Organisers' tracker / press"
  },
  {
    name: "Marianne (Freedom Flotilla III)",
    year: 2015,
    lat: 31.7167,
    lon: 32.55,
    status: "Boarded ~100 nm from Gaza, diverted to Ashdod",
    confidence: "High",
    source: "Freedom Flotilla tracker / press"
  },
  {
    name: "Zaytouna-Oliva (Women’s Boat to Gaza)",
    year: 2016,
    lat: 31.45, // approx
    lon: 34.17, // approx
    status: "Intercepted ~14 nm off Gaza coast (approx position)",
    confidence: "Medium (approx)",
    source: "Press reports (distance-based)"
  },
  {
    name: "Spirit of Humanity",
    year: 2009,
    lat: 31.60, // approx
    lon: 34.15, // approx
    status: "Intercepted ~20 nm off Gaza coast (approx position)",
    confidence: "Medium (approx)",
    source: "UN / press reports"
  },
  {
    name: "Mavi Marmara",
    year: 2010,
    lat: 32.64113,
    lon: 33.56727,
    status: "Raided in international waters; casualties and diplomatic fallout",
    confidence: "High",
    source: "UN report / investigations"
  }
];

function loadPastFlotillas() {
  pastFlotillas.forEach(b => {
    L.circleMarker([b.lat, b.lon], {
      radius: 6,
      color: "#ff8080",
      fillColor: "#ff8080",
      fillOpacity: 0.9
    })
    .addTo(map)
    .bindPopup(
      `<b>${b.name} (${b.year})</b><br>
       ${b.status}<br>
       <em>Confidence:</em> ${b.confidence}<br>
       <small>Source: ${b.source}</small>`
    );
  });
}

// Run after map init
loadPastFlotillas();


</script>
</body>
</html>


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Digital Sumud Flotilla Tracker</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    html, body { margin:0; height:100%; background:#000; }
    #map { position:absolute; top:0; bottom:0; left:280px; right:0; }

    /* Sidebar */
    #sidebar {
      position: fixed; left: 0; top: 0; bottom: 0; width: 280px;
      background: rgba(0, 0, 0, 0.9); color: #fff;
      display:flex; flex-direction:column; justify-content:space-between;
      font-family: sans-serif; z-index:1000; padding:12px;
      border-right:2px solid #444;
    }

    #quote { font-size:14px; font-style:italic; text-align:center; padding:10px; }

    /* Martyr ticker scroll */
    #ticker-container {
      height: 35px; overflow:hidden; border-top:1px solid #666; border-bottom:1px solid #666;
      margin-top:10px;
    }
    #ticker {
      white-space:nowrap; display:inline-block;
      animation: scroll 30s linear infinite; font-size:13px;
    }
    @keyframes scroll {
      0% {transform: translateX(100%);}
      100% {transform: translateX(-100%);}
    }

    /* Live flashing marker */
    @keyframes flash {
      0%,100% {box-shadow: 0 0 5px 5px rgba(0,255,0,0.4);}
      50% {box-shadow: 0 0 15px 15px rgba(0,255,0,0);}
    }
    .live-marker {
      background: limegreen;
      border-radius: 50%;
      width: 14px; height: 14px;
      animation: flash 1s infinite;
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <div id="quote"></div>
    <div id="ticker-container"><div id="ticker"></div></div>
  </div>
  <div id="map"></div>

  <script>
    // Quotes & poems
    const quotes = [
      `"We will have a homeland, even if it is only a word." — Refaat Alareer`,
      `"Don't tell me I'm brave. Tell the world why I had to be." — Hind Rajab`,
      `"The occupation fears our words more than our weapons." — Shireen Abu Akleh`,
      `"If I must die, let it be with dignity." — Refaat Alareer`,
      `"I will return, even if only in my children’s dreams." — Unknown`
    ];
    let quoteIndex = 0;
    const quoteEl = document.getElementById("quote");
    function cycleQuotes() {
      quoteEl.textContent = quotes[quoteIndex];
      quoteIndex = (quoteIndex + 1) % quotes.length;
    }
    cycleQuotes();
    setInterval(cycleQuotes, 7000);

    // Martyr ticker
    const martyrs = [
      "Shireen Abu Akleh","Hind Rajab","Refaat Alareer","Ahmad Erekat",
      "Iyad Hallaq","Mohammed Abu Khdeir","Yasser Arafat","Rachel Corrie",
      "Fadi Alloun","Ali Dawabsheh"
    ];
    document.getElementById("ticker").textContent = martyrs.join(" ✦ ");

    // Leaflet map setup
    const map = L.map('map').setView([31.5, 34.5], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OSM' }).addTo(map);

    let polyline, breadcrumbMarkers=[], liveMarker;

    // Load positions.json and render
    function loadPositions() {
      fetch('positions.json?_t=' + Date.now())
      .then(res => res.json())
      .then(positions => {
        if (!positions.length) return;

        // Clear old layers
        if(polyline) map.removeLayer(polyline);
        breadcrumbMarkers.forEach(m => map.removeLayer(m));
        if(liveMarker) map.removeLayer(liveMarker);

        // Draw trail
        polyline = L.polyline(positions, {color:"red", weight:3}).addTo(map);

        // Breadcrumb markers
        breadcrumbMarkers = positions.slice(0,-1).map(coord => 
          L.circleMarker(coord, {
            radius:4, color:"#555", fillColor:"#999", fillOpacity:1
          }).addTo(map)
        );

        // Live marker (flashing)
        const last = positions[positions.length-1];
        const liveIcon = L.divIcon({ className:"live-marker" });
        liveMarker = L.marker(last, { icon: liveIcon }).addTo(map);

        // Breadcrumb fade on zoom
        map.on('zoomend', () => {
          const zoom = map.getZoom();
          const opacity = Math.min(1, Math.max(0.2, (zoom-4)/6));
          breadcrumbMarkers.forEach(m => m.setStyle({opacity, fillOpacity:opacity}));
        });

        map.fitBounds(polyline.getBounds());
      });
    }

    // Load now & auto-refresh every 15 min
    loadPositions();
    setInterval(loadPositions, 900000);
  </script>
</body>
</html>

